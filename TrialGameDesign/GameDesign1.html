<!DOCTYPE html>
<html>
<!--
Name: Rachel Higgins
Class: CS 4183 Video Game Design
Semester: Fall 2017
Professor: David Cline
Assignment: Sprint 1
Goal: Create a basic game with sprites and sound effects.  This game is a shooter 
      where the character must survive a for a certain amount of time win and defeat
	  as many enemies as possible to earn points.  A boss must be defeated at the end to win.
Credits:
	Dragon Sprite: from http://bestanimations.com/Fantasy/Dragons/Dragons2.html
	by Todd Lockwood for Dungeons & Dragons Draconomicon.
	Space Ship Sprite: from https://dribbble.com/shots/1658999-Space-ship-Game-Character-Sprite-Sheet-Animation
	by bevouliin from Space Ship Game Character Sprite Sheet Animation.
	Fire Sprite: from http://spritefx.blogspot.com/2013/04/fire-sprites.html by cgman.
	Boss Sprite:
	Damage-To-Enemy Sound:
	Damage-To-Dragon Sound:
	Win Sound:
	Lose Sound:
	Music:
 -->

  <head>
    <meta charset="UTF-8">
    <title>Dragon Shooter</title>
  </head>
  <body style="background-color: darkred ">
    <h1 style="font-names: Sylfaen; font-color: darkred; font-size: 36px;
    text-align: center ">
      Dragon Shooter Game</h1>
    <p style="font-names: Sylfaen; font-color: purple; font-size: 20px;
    text-align: center ">
      The goal of this sidescrolling game is to last three minutes and against
      enemies and then defeat the final boss.  Use the arrow keys to move,
      the x key to shoot, and the z key to defend.
      <p>
    <canvas id="myCanvas" width="900" height="600" style="padding: 0; margin: auto; display: block;"></canvas>
    <img id="dragonImage" style="display:none" src="DragonWorld2.png"></img>
	<img id="spaceShipImage" style="display:none" src="SpaceShip2.png"></img>
	<img id="fireImage" style="display:none" src="DragonFire.png"></img>

    <script>
		var gameState;
		var canvas;
		var drawing;
		
		var makeSprite = function(imageName, x, y, horizontal, vertical)
		{
			var sprite = {};
			sprite.image = document.getElementById(imageName);
			sprite.x = x;
			sprite.y = y;
			sprite.w = sprite.image.width;
			sprite.w = sprite.image.height;
			sprite.horizontal = horizontal;
			sprite.vertical = vertical;
			sprite.border = 0.0;
			return sprite;
		}
		   
		var moveSprite = function(move)
		{
			move.x += move.horizontal;
			move.y += move.vertical;

			if (move.x < -move.w)
			{
				move.x += canvas.width;
			} 
			if (move.x > canvas.width)
			{
				move.x -= canvas.width;
			}
		}
		
		var drawSprite = function(sprite)
		{
			//gameState.dragon  = makeSprite("dragonImage",  10,  10,  0, 0);
			drawing.drawImage(sprite.image, sprite.x, sprite.y, sprite.w, sprite.h);
		}

		var drawGame = function()
		{
			var w = canvas.width;
			var h = canvas.height;

			// Draw a background rectangle
			drawing.fillStyle = "#BBBBFF";  // light blue fill color
			drawing.fillRect(0,0,w,h);      // fill the canvas with light blue
			drawing.strokeRect(0,0,w,h);    // draw a black border

			// Draw the ship image
			drawSprite(gameState.dragon);
			for(i = 0; i < 60; i++)
			{
				var ships = gameState.shipsArray;
				var displayedShip = ships[i];
				drawSprite(displayedShip);
				
				//if(displayedShip[i] == hit)
				//{
				//	 gameState.enemies.splice(i,1);
				//}
			}
		}
		
		var animateGame = function()
		{
			// Call animateGame again in about 1/60 of a second
			window.requestAnimationFrame(animateGame);

			// change the x location of the ship
			moveSprite(gameState.dragon);
			for(i = 0; i < 60; i++)
			{
				var ships = gameState.shipsArray;
				var displayedShip = ships[i];
				moveSprite(displayedShip);
				
				//Removes enemy if hit by a flame
				//if(displayedShip[i] == hit)
				//{
				//	 gameState.shipsArray.splice(i,1);
				//}
			}
			
			for (var f = gameState.fire.length-1; f >= 0; f--)
			{
				collideShot(f);
			}

			// Draw the game
			drawGame();
		}
		
		var getCollisionBounds = function(sprite)
		{
			var boundaries = {};
			var border = sprite.border;
			bounds.xmin = sprite.x + border;
			bounds.ymin = sprite.y + border;
			bounds.xmax = sprite.x + sprite.width - border;
			bounds.ymax = sprite.y + sprite.width - border;
			return boundaries;
		}
		
		var spritesCollide = function(spriteA, spriteB)
		{
			// collision bounds for spriteA and spriteB
			var dragonOrFire = getCollisionBounds(spriteA); 
			var enemyShip = getCollisionBounds(spriteB);

			// spriteB is to the right or left of spriteA
			if (enemyShip.xmin > dragonOrFire.xmax)
			{
				return false;
			}
			if (enemyShip.xmax < dragonOrFire.xmin)
			{
				return false;
			}

			// spriteB is above or below spriteA
			if (enemyShip.ymax < dragonOrFire.ymin)
			{
				return false;
			}
			if (enemyShip.ymin > dragonOrFire.ymax)
			{
				return false;
			}

			// The two sprites collide if spriteA is not
			// left of, right of, above, or below spriteB
			return true;
		}
		
		var collideShot = function(f)
		{
			var flame = gameState.fire[f];
			var target = gameState.ships;
			
			for(var i = 0; i < target.length; i++)
			{
				if (spritesCollide(flame, target[f]))
				{
					gameState.fire.splice(f, 1); // delete shot
					target.splice(i, 1);         // delete enemy
					return;
				}
			}
		}
		
		var spriteOnCanvas = function(sprite)
		{
			var xBound = canvas.width;
			var yBound = canvas.height;
			f = getCollisionBounds(sprite);

			// check left and right
			if (f.xmin < 0)
			{
				return false;
			}
			if (f.xmax > canvas.width)
			{
				return false;
			}

			// check top and bottom
			if (f.ymin < 0)
			{
				return false;
			}
			if (f.ymax > canvas.height)
			{
				return false;
			}

			// we have checked left, right, top, and bottom
			// so the sprite must be on the canvas.
			return true;
		}
		
		var moveAway = function(sprite)
		{
			var boundary = getCollisionBounds(sprite); 

			// bounce off left and right edge of canvas
			if (boundary.xmin < 0) 
			{
				sprite.horizontal = Math.abs(sprite.horizontal);
			}
			if (boundary.xmax > canvas.width) 
			{
				sprite.horizontal = -Math.abs(sprite.horizontal);
			}

			// bounce off top and bottom edge of canvas
			if (boundary.ymin < 0) 
			{
				sprite.vertical = Math.abs(sprite.vertical);
			}
			if (boundary.ymax > canvas.height) 
			{
				sprite.vertical = -Math.abs(sprite.vertical);
			}
		}
		
		
			// The window.onload function will run when the page first loads
		window.onload = function()
		{
			window.addEventListener("keyup", onKeyUp);
			window.addEventListener("keydown", onKeyDown);
			window.addEventListener("click", onClick);
			
			// First, Get a reference to the canvas, looking it up by name
			canvas = document.getElementById("myCanvas");
			// Next, get a 2d "graphics context" for the canvas.
			drawing = canvas.getContext("2d");
			
		    gameState = {};
		    gameState.dragon  = makeSprite("dragonImage",  10,  10,  0, 0);
		    gameState.fire  = makeSprite("fireImage",  10,  10,  0, 0);
		    gameState.shipsArray = [];
		    for (var i = 0; i < 60; i++)
		    {
			    var enemyShip = makeSprite("spaceShipImage", 100+110*i, 100, 0.0, 0.0);
			    gameState.shipsArray.push(enemyShip);
		    } 
			
			animateGame();
		}
		
		var onKeyDown = function(event)
		{
			//Allows the sprite to move in any direction.
			var dragon = gameState.dragon;
			if (event.keyCode == 37) 
			{
				ship.horizontal = -10.0;
			}
			if (event.keyCode == 39) 
			{
				ship.horizontal = 10.0;
			}
			if (event.keyCode == 40) 
			{
				ship.vertical = -10.0;
			}
			if (event.keyCode == 38) 
			{
				ship.vertical = 10.0;
			}
			console.log(event.keyCode);
		}
		
		var onKeyUp = function(event)
		{
			//Stops the dragon from moving after the key is released.
			var dragon = gameState.dragon;
			if ((event.keyCode == 37) || (event.keyCode == 38) || 
				(event.keyCode == 39) || (event.keyCode == 40))
			{
				dragon.horizontal = 0;
				dragon.vertical = 0;
			}
		}
		
		var onClick = function(event)
		{
			if (event.keyCode == 32)
			{
				var f = gameState.fire;
				var flame = new Sprite("fireImage", 0, 20, 0, 0);
				flame.x = f.x + 0.5 * f.width - 0.5 * flame.width;
				flame.y = f.y - flame.height;
				gameState.fire.push(flame);
				
				var timeStart = new Date().getTime();
				var timeEnd = date.getTime() - timeStart;
				while(timeEnd < 1)
				{
					var timeEnd = date.getTime() - timeStart;
					if(1 <= timeEnd)
					{
						gameState.fire.pop(flame);
					}
				}
			}
		}
	
    </script>
  </body>
</html>